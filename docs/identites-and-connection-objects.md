<!--
GENERATED FILE - DO NOT EDIT
This file was generated by [MarkdownSnippets](https://github.com/SimonCropp/MarkdownSnippets).
Source File: /docs/mdsource/identites-and-connection-objects.source.md
To change this file edit the source file and then run MarkdownSnippets.
-->

# Identity and Connection objects

<!-- toc -->
## Contents

  * [Overview](#overview)
  * ["Identity" objects](#identity-objects)
    * [ServerIdentity](#serveridentity)
    * [ProjectIdentity](#projectidentity)
    * [Get identity from a git remote url](#get-identity-from-a-git-remote-url)
    * [Get identity from environment variables](#get-identity-from-environment-variables)
  * ["Connection" objects](#connection-objects)
    * [ServerConnection](#serverconnection)
    * [ProjectConnection](#projectconnection)<!-- endToc -->

## Overview

The connections parameters for a GitLab Server or project may be specified as "Identity" or "Connection" objects.

- An "identity" object encapsulates all data required to identify a server or a project.
- A "connection" object combines the data to identify a project or server with an access token required to authenticate.

## "Identity" objects

### ServerIdentity

A `ServerIdentity` object encapsulates all data to identify a Gitlab server.

It can be created from the GitLab server's host name or url.

<!-- snippet: ServerIdentity -->
<a id='snippet-ServerIdentity'></a>
```cs
ServerIdentity serverIdentity;

// Create ServerIdentity from host name. This assumes the server uses HTTPS on the default port
serverIdentity = new ServerIdentity(host: "example.com");

// To use http or a different port, pass in a protocol and/or a port in addition to the host name
serverIdentity = new ServerIdentity(protocol: "http", host: "example.com");
serverIdentity = new ServerIdentity(protocol: "https", host: "example.com", port: 8086);

// Alternatively, a server identity can be initialized from the server url
serverIdentity = ServerIdentity.FromUrl("https://gitlab.example.com:8080");
```
<sup><a href='/examples/Frosting/Examples.cs#L59-L72' title='Snippet source file'>snippet source</a> | <a href='#snippet-ServerIdentity' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

### ProjectIdentity

A `ProjectIdentity` object encapsulates all data to identify a project on a Gitlab server.
This includes

- The server's identity
- The project namespace (i.e. the name of the user or group (including subgroups) that owns the project)
- The project name

A project identity can be constructed from these individual values:

<!-- snippet: ProjectIdentity-Simple -->
<a id='snippet-ProjectIdentity-Simple'></a>
```cs
ProjectIdentity projectIdentity;

// A ProjectIdentity can be constructed from a server identity, namespace and project name
projectIdentity = new ProjectIdentity(new ServerIdentity("example.com"), "example-group", "example-project");

// Alternatively, the project path (which is both the namespace and project name) can be passed in as a single parameter
projectIdentity = new ProjectIdentity(new ServerIdentity("example.com"), "example-group/example-project");
```
<sup><a href='/examples/Frosting/Examples.cs#L78-L87' title='Snippet source file'>snippet source</a> | <a href='#snippet-ProjectIdentity-Simple' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

Project identity objects are immutable record types, modified copies can be created using C#'s `with` expression. 

<!-- snippet: ProjectIdentity-CopyAndModify -->
<a id='snippet-ProjectIdentity-CopyAndModify'></a>
```cs
var projectIdentity = new ProjectIdentity(new ServerIdentity("example.com"), "example-group", "example-project");

// Changing the "Project" property creates the identity of a project in the same group/subgroup on the same GitLab server
var siblingProjectIdentity = projectIdentity with { Project = "sibling-project" };

ProjectIdentity otherProjectIdentity;
// Changing the "ProjectPath" property will also update the "Project" and "Namespace" properties
otherProjectIdentity = projectIdentity with { ProjectPath = "another-group/subgroup/another-project" };
// This is equivalent to
otherProjectIdentity = projectIdentity with { Namespace = "another-group/subgroup", Project = "another-project" };
```
<sup><a href='/examples/Frosting/Examples.cs#L100-L112' title='Snippet source file'>snippet source</a> | <a href='#snippet-ProjectIdentity-CopyAndModify' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

### Get identity from a git remote url

The project identity can be extracted from the git remote url of a (local) git repository.
This can be useful to e.g. avoid hard-coding GitLab project information in a Cake build script and instead retrieve the data from the local git repository.

<!-- snippet: ProjectIdentity-FromRemoteUrl -->
<a id='snippet-ProjectIdentity-FromRemoteUrl'></a>
```cs
// The project identity can be initialized from a git remote url (either SSH or HTTP urls)
ProjectIdentity projectIdentity;
projectIdentity = ProjectIdentity.FromGitRemoteUrl("git@example.com:example-group/example-project.git");
projectIdentity = ProjectIdentity.FromGitRemoteUrl("https://example.com/example-group/example-project.git");
```
<sup><a href='/examples/Frosting/Examples.cs#L91-L96' title='Snippet source file'>snippet source</a> | <a href='#snippet-ProjectIdentity-FromRemoteUrl' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->


### Get identity from environment variables

If a build is running on GitLab CI, the current server and project identities can be determined automatically from [GitLab CI's predefined variables](https://docs.gitlab.com/ee/ci/variables/predefined_variables.html).

A build running on GitLab CI can use the following aliases to determine the current server or project identity:

- `GitLabTryGetCurrentServerIdentity()`: Creates a `ServerIdentity` for the current build
- `GitLabTryGetCurrentProjectIdentity()`: Creates a `ProjectIdentity` for the current build

If the build is not running in a GitLab CI pipeline, both aliases will return `null`.

## "Connection" objects

### ServerConnection

`ServerConnection` extends `ServerIdentity` with an access token and thus encapsulates all data required for identifying a server and authenticating to the GitLab API.

Initialization of `ServerConnection` is analogous to the initialization of `ServerIdentity` with the addition of an `accessToken` parameter

<!-- snippet: ServerConnection-Simple -->
<a id='snippet-ServerConnection-Simple'></a>
```cs
var serverConnection = new ServerConnection("example.com", "ACCESSTOKEN");
```
<sup><a href='/examples/Frosting/Examples.cs#L119-L121' title='Snippet source file'>snippet source</a> | <a href='#snippet-ServerConnection-Simple' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

A `ServerConnection` can also be created from an existing `ServerIdentity`.

<!-- snippet: ServerConnection-FromIdentity -->
<a id='snippet-ServerConnection-FromIdentity'></a>
```cs
var serverIdentity = new ServerIdentity("example.com");

ServerConnection serverConnection;
serverConnection = new ServerConnection(serverIdentity, "ACCESSTOKEN");

// since ProjectIdentity also provides a server identity, a server connection can also be initialized from a git remote url:
var projectIdentity = ProjectIdentity.FromGitRemoteUrl("git@example.com:example-group/example-project.git");
serverConnection = new ServerConnection(projectIdentity.Server, "ACCESSTOKEN");
```
<sup><a href='/examples/Frosting/Examples.cs#L125-L135' title='Snippet source file'>snippet source</a> | <a href='#snippet-ServerConnection-FromIdentity' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

### ProjectConnection

`ProjectConnection` extends `ProjectIdentity` with an access token and thus encapsulates all data required for identifying a project and authenticating to the GitLab API.

Initialization of `ProjectConnection` is analogous to the initialization of `ProjectIdentity` with the addition of an `accessToken` parameter

<!-- snippet: ProjectConnection-Simple -->
<a id='snippet-ProjectConnection-Simple'></a>
```cs
ProjectConnection projectConnection;

// A ProjectConnection can be constructed from a server identity, namespace, project name and access token
projectConnection = new ProjectConnection(new ServerIdentity("example.com"), "example-group", "example-project", "ACCESSTOKEN");

// Alternatively, the project path (which is both the namespace and project name) can be passed in as a single parameter
projectConnection = new ProjectConnection(new ServerIdentity("example.com"), "example-group/example-project", "ACCESSSTOKEN");
```
<sup><a href='/examples/Frosting/Examples.cs#L142-L151' title='Snippet source file'>snippet source</a> | <a href='#snippet-ProjectConnection-Simple' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

A `ProjectConnection` can also be created from an existing `ProjectIdentity`, allowing e.g. the usage for `FromGitRemoteUrl()` as shown above:

<!-- snippet: ProjectConnection-FromIdentity -->
<a id='snippet-ProjectConnection-FromIdentity'></a>
```cs
var projectIdentity = ProjectIdentity.FromGitRemoteUrl("git@example.com:example-group/example-project.git");

var projectConnection = new ProjectConnection(projectIdentity, "ACCESSTOKEN");
```
<sup><a href='/examples/Frosting/Examples.cs#L155-L159' title='Snippet source file'>snippet source</a> | <a href='#snippet-ProjectConnection-FromIdentity' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->
