<!--
GENERATED FILE - DO NOT EDIT
This file was generated by [MarkdownSnippets](https://github.com/SimonCropp/MarkdownSnippets).
Source File: /docs/mdsource/testing.source.md
To change this file edit the source file and then run MarkdownSnippets.
-->

# Testing

To facilitate testing of Cake build scripts and tasks, `Cake.GitLab` supports mocking of the aliases it provides.

This is realized through the `IGitLabProvider` interface.
It defines methods for all `Cake.GitLab` aliases, decoupling the implementation of the Cake aliases from the aliases themselves.

- By default, the aliases will use the implementation in `DefaultGitLabProvider`
- However, a different implementation of the interface can be provided by using a `ICakeContext` that implements `IGitLabCakeContext`.
  - When an alias is used with a context that implements that interface, the `IGitLabProvider` returned by the context's `GitLab` property will be used instead of the default implementation
  - This allows injecting alternative/test implementation of that interface

The following snippet shows an example of a (xunit-based) unit test that follows this approach.
A mock of `IGitLabProvider` is created dynamically using [moq](https://github.com/devlooped/moq)

<!-- snippet: Example-Testing -->
<a id='snippet-Example-Testing'></a>
```cs
[Fact]
public async Task GitLab_mocking_example()
{
    //
    // ARRANGE
    //

    // Create a mock of IGitLabProvider
    var gitlabProviderMock = new Mock<IGitLabProvider>();
    {
        gitlabProviderMock
            .Setup(x => x.RepositoryGetBranchesAsync(It.IsAny<string>(), It.IsAny<string>(), It.IsAny<ProjectId>()))
            .ReturnsAsync(
                [
                    new Branch() { Name = "example-branch" }
                ]);
    }

    // Create a mock IGitLabCakeContext
    var contextMock = new Mock<IGitLabCakeContext>();
    {
        contextMock.Setup(x => x.GitLab).Returns(gitlabProviderMock.Object);

        contextMock.Setup(x => x.Log).Returns(new FakeLog());

        var fileSystem = new FakeFileSystem(FakeEnvironment.CreateUnixEnvironment());
        contextMock.Setup(x => x.FileSystem).Returns(fileSystem);
    }

    //
    // ACT
    //
    var branches = await contextMock.Object.GitLabRepositoryGetBranchesAsync("https://example.com", "ACCESSTOKEN", 23);

    //
    // ASSERT
    //
    Assert.Collection(
        branches,
        branch => Assert.Equal("example-branch", branch.Name)
    );
}
```
<sup><a href='/examples/Testing/UnitTestExample.cs#L9-L54' title='Snippet source file'>snippet source</a> | <a href='#snippet-Example-Testing' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->
